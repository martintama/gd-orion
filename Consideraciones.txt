- Los giftcards no restan credito de quien lo regala
- Al migrar la base, se crean los clientes y proveedores. Luego, los usuarios se generan usando el DNI como username y CUIT en caso de proveedor
La clave inicial en ambos casos es la misma para todos, 123456.
- El nro de cupon es el PK de la tabla de cupones
- Fecha entrega = fecha consumo
- IMPORTENTE Recordar restar el stock de los cupones!! en base a restante = total - compras + devoluciones


Funcionalidades por defecto

Administrativos
. ABM de Cliente
. ABM de Proveedor
. ABM de Rol
. Facturación a Proveedores
. Publicar Cupón
. Listado Estadístico

Clientes
. Cargar Crédito
. Comprar Cupón
. Comprar GiftCard
. Historial de Compra de cupones
. Pedir Devolución

Proveedores
. Armar Cupón
. Registro de consumo de cupon

Accesible desde login:
. Registro de Usuario



 

Roles
- Proveedor
- Administrativo
- Cliente
- (Otros a gusto)

Tablas
-- cargas
-- ciudades
-- clientes
-- clientes_ciudades
-- compras
-- compras_estados
-- consumos
-- cupones
-- cupones_ciudades
-- devoluciones
-- facturas
-- facturas_items
-- funcionalidades
-- gift_cards
-- proveedores
-- roles
roles_funcionalidades
--rubros
-- tarjetas (Se carga a partir de la GUi)
-- tipos_pago
-- tipos_tarjeta
-- usuarios
-- usuarios_tipos



Estrategia:

Logueo.

Se ingresan el usuario y password. Se verifica si todos los datos están completos y se devueve un return_status el que puede ser:

0 - Todo OK: Logueo
1 - Usuario o password incorrecto
2 - Falta completar usuario o password
3 - Usuario baneado

General

Conexiones a la base se genera una nueva cada vez que se realiza una transaccion. Se utiliza una conexion global.

Roles

Suponemos que hay un usuario ya creado, el "administrador general", cuyo tipo de usuario
es "Administrativo" y posee el rol de "Administrador General".

A este rol, Administrador General, se le asignaron todas las funcionalidades

No se permite deshabilitar un rol que este asociado aún a un usuario. Esto se efectiviza
utilizando un stored procedure que devuelva un 0 si no hubo problemas, o un 1 si no se pudo
inhabilitar porque hay usuarios asociados.

En este caso se consulta al usuarios si desea continuar deshabilitando también los usuarios
y solo así se puede deshabilitar el rol.

- Cuando se editan las funcionalidades, se desactivan las funcionalidades existentes y se cargan nuevamente.

ABM de clientes:

- El DNI además de ser numérico debe ser entre 1000000 y 99999999
- Se realiza una verificación de que la dirección de correo es válida, pero solo se hace una
	comprobación estandar. Las direcciones según el RFC correspondiente pueden ser de lo
	más variadas. Una página lo explica: http://haacked.com/archive/2007/08/21/i-knew-how-to-validate-an-email-address-until-i.aspx
	La dirección !def!xyz%abc@example.com es válida según la especificación.
	Se copió el método de la siguiente dirección: http://www.dreamincode.net/code/snippet1374.htm
- La fecha de nacimiento debe estar entre 01/01/1900 y 31/12/2050	
- Seleccion de ciudades:

Se consideró la opción de usar la "Selección por buscador" tal cual se especifica en la GUIA DE ABMs,
pero se descartó por no ser cómoda a la hora de elegir más de una ciudad.
También se consideró la idea de realizar un formulario con checkboxes fijos, uno para
cada ciudad, pero si bien las ciudades no se pueden modificar, no nos pareció correcto 
ya que limita mucho el diseño (Si se insertara una ciudad nueva que comience con A, como se 
encuentran odenados alfabeticamente, habría que mover casi todos los checkboxes para abajo.
Finalmente se decidió por la idea de tener dos listas, una de ciudades seleccionadas y otra de
ciudades disponibles. Similar a cómo se seleccionan las funcionalidades en los roles ya que
conserva la facilidad de uso y la flexibilidad.
	
- Grabar datos
A la hora de grabar datos, se verifica que no exista el usuario, tanto activo como inactivo. Esto es así
porque podria suceder que un usuario inhabilitado se vuelva a habilitar por parte del administrativo

Se verifica además que no exista otro cliente con el mismo teléfono o DNI. Esas son los datos que es verifican
para asegurar que no se da el caso que un cliente se loguea con más de un usuario.

- Cuando se editan las ciudades, se desactivan todas y se cargan nuevamente

- La carga inicial de $15 se realiza con el medio de pago "Sistema", para diferenciarla de las cargas que realiza el cliente
Devoluciones
Los cupones devuefltos vuelven a figurar en el stock del cliente