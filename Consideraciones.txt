TODO!
- Verificar estado de los proveedoers
- Explciar por que pasamos el DNI y CUIT de varchars a int
- Verificar que el CUIT sea valido (en el abm de proveedoreS)
- Inhabilitar usuarios significa NO inhabilitar el login sino solo las funcionalidades que dicen.
- Averiguar si hay que usar verificaicon dinamica en el abm o se puede con los try catch
- Verificar los rangos de fecha de nacimiento contra la BBDD


- Los giftcards no restan credito de quien lo regala

- El nro de cupon es el PK de la tabla de cupones
- Fecha entrega = fecha consumo


Funcionalidades por defecto

Administrativos
. ABM de Cliente
. ABM de Proveedor
. ABM de Rol
. Facturación a Proveedores
. Publicar Cupón
. Listado Estadístico

Clientes
. Cargar Crédito
. Comprar Cupón
. Comprar GiftCard
. Historial de Compra de cupones
. Pedir Devolución

Proveedores
. Armar Cupón
. Registro de consumo de cupon

Accesible desde login:
. Registro de Usuario



 

Roles
- Proveedor
- Administrativo
- Cliente
- (Otros a gusto)

Tablas
-- cargas
-- ciudades
-- clientes
-- clientes_ciudades
-- compras
-- compras_estados
-- consumos
-- cupones
-- cupones_ciudades
-- devoluciones
-- facturas
-- facturas_items
-- funcionalidades
-- gift_cards
-- proveedores
-- roles
roles_funcionalidades
--rubros
-- tarjetas (Se carga a partir de la GUi)
-- tipos_pago
-- tipos_tarjeta
-- usuarios
-- usuarios_tipos



Estrategia:

MIGRACION

Tabla proveedores:
- Se optó por cargar el cuit como campo sin guiones por una cuestion de que a la hora de ingresar el dato es más fácil cargarlo sin guiones que con ellos. (en el registro)
- El campo "email", al no estar presente en la migración, se optó por completarlo con campo '' (vacio). Se barajó la idea de completar con 'No posee' o 'notiene@notiene.com', pero
se descartaron porque ensucian el campo. Preferiblemente dejarlo vacio y se pueda completar posteriormente.
- El campo "contacto" tampoco estaba presente. En este caso se optó por poner como dato '-' (un guión) para simbolizar que no se posee ese dato.
Al migrar la base, los usuarios de los proveedores se generan usando el CUIT como username. La clave inicial en ambos casos es la misma para todos, 123456.

Tabla clientes:
- Al migrar la base, los usuarios de los clientes se generan usando el DNI como username. La clave inicial en ambos casos es la misma para todos, 123456.

Tabla cupones:
- Como la fecha de alta (cuando se genera un nuevo cupon) no está en la base, se optó por tomar el dicha fecha como la misma de publicación
- La fecha de vencimiento de canje se tomó como la fecha de vencimiento del cupón más 5 dias, para darle tiempo a quien compra el cupón de organizar el canje.
- La cantidad máxima de cupones por usuario, para aquellos cupones ya en sistema se estableció en 5.
- La fecha en la que el cupón se publica (por el administrativo) para los que ya están en sistema, se estableció como la de publicación por el proveedor + 1.
- El stock con el que se inicializan los cupones es el campo groupon_cantidad. 

Tabla compras:
- Inicialmente se cargan todos los cupones con el estado "comprado". Una vez que se cargan la tabla de devoluciones y consumos, se actualiza dicho estado según corresponda.
- Para todos los cupones que hayan quedado como "comprado", se setearon como "vencidos" todos los cupones que se hayan comprado hasta el 26/12/2009. Esto se hizo así para mantener 
la coherencia de vencimiento a los 5 dias de la compra: Como el cupón comprado más "recientemente" es del 31/12/2009, se asume que hoy es 01/01/2010 
(Tomamos como consideración que si fuera otra fecha más reciente, habría más registros de esas fechas. Como no lo podemos comprobar, lo suponemos).
- Luego de completadas las tablas de consumos, compras y devoluciones, se actualiza el stock de cada cupón para que guarden coherencia con las tablas de consumos y devoluciones:
	cantidad_final = cantidad_inicial - cantidad_cupones_entregados - cantidad_cupones_comprados (sin canjear)
	los cupones devueltos y y vencidos no restan del stock ya que son cupones que no fueron consumidos

Tabla devoluciones:
- Como el motivo no estaba en la tabla maestra, se cargaron todas las devoluciones existentes como "- no especifica (migración inicial) -"


Logueo.

Se ingresan el usuario y password. Se verifica si todos los datos están completos y se devueve un return_status el que puede ser:

0 - Todo OK: Logueo
1 - Usuario o password incorrecto
2 - Falta completar usuario o password
3 - Usuario baneado

General

Conexiones a la base se genera una nueva cada vez que se realiza una transaccion. Se utiliza una conexion global.

Roles

Suponemos que hay un usuario ya creado, el "administrador general", cuyo tipo de usuario
es "Administrativo" y posee el rol de "Administrador General".

A este rol, Administrador General, se le asignaron todas las funcionalidades

No se permite deshabilitar un rol que este asociado aún a un usuario. Esto se efectiviza
utilizando un stored procedure que devuelva un 0 si no hubo problemas, o un 1 si no se pudo
inhabilitar porque hay usuarios asociados.

En este caso se consulta al usuarios si desea continuar deshabilitando también los usuarios
y solo así se puede deshabilitar el rol.

- Cuando se editan las funcionalidades, se desactivan las funcionalidades existentes y se cargan nuevamente.

ABM de clientes:

- El DNI además de ser numérico debe ser entre 1000000 y 99999999
- Se realiza una verificación de que la dirección de correo es válida, pero solo se hace una
	comprobación estandar. Las direcciones según el RFC correspondiente pueden ser de lo
	más variadas. Una página lo explica: http://haacked.com/archive/2007/08/21/i-knew-how-to-validate-an-email-address-until-i.aspx
	La dirección !def!xyz%abc@example.com es válida según la especificación.
	Se copió el método de la siguiente dirección: http://www.dreamincode.net/code/snippet1374.htm
- La fecha de nacimiento debe estar entre 01/01/1900 y 31/12/2050	
- Seleccion de ciudades:

Se consideró la opción de usar la "Selección por buscador" tal cual se especifica en la GUIA DE ABMs,
pero se descartó por no ser cómoda a la hora de elegir más de una ciudad.
También se consideró la idea de realizar un formulario con checkboxes fijos, uno para
cada ciudad, pero si bien las ciudades no se pueden modificar, no nos pareció correcto 
ya que limita mucho el diseño (Si se insertara una ciudad nueva que comience con A, como se 
encuentran odenados alfabeticamente, habría que mover casi todos los checkboxes para abajo.
Finalmente se decidió por la idea de tener dos listas, una de ciudades seleccionadas y otra de
ciudades disponibles. Similar a cómo se seleccionan las funcionalidades en los roles ya que
conserva la facilidad de uso y la flexibilidad.

	- Grabar datos
	A la hora de grabar datos, se verifica que no exista el usuario, tanto activo como inactivo. Esto es así
	porque podria suceder que un usuario inhabilitado se vuelva a habilitar por parte del administrativo
	
	Se verifica además que no exista otro cliente con el mismo teléfono o DNI. Esas son los datos que es verifican
	para asegurar que no se da el caso que un cliente se loguea con más de un usuario.
	
	- Cuando se editan las ciudades, se desactivan todas y se cargan nuevamente
	
	- La carga inicial de $15 se realiza con el medio de pago "Sistema", para diferenciarla de las cargas que realiza el cliente
	
ABM de proveedores
- Para buscar todos los CUIT, se carga -1 porque es un valor que no se podrá cargar manualmente.


Comprar GiftCard
- Si bien en la base existente hay giftcard con todos los valores entre 25 y 99, se estipuló que a partir de la migración el monto no sea tan libre sino acotado entre { $25, $30, $50, $75 y $100 }.
- En la selección por busqueda, el cliente logueado se omite de los resultados para evitar que se autocompren una giftcard.
- En esta misma selección por busqueda, se omiten todos los clientes inhabilitados.

Devoluciones
	Los cupones devuefltos vuelven a figurar en el stock del cliente
	
	
